<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manufacturer Portal - Certificate Management</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

  <style>
    :root {
      --field-height: 40px;
      --field-gap: 10px;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 30px;
      background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
      padding: 35px;
      border-radius: 14px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.9s ease-out;
    }

    h1 {
      text-align: center;
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 25px;
      color: #ffffff;
      border-bottom: 4px solid #ff6b9d;
      display: inline-block;
      padding-bottom: 6px;
      width: 100%;
    }

    .network-info {
      background: linear-gradient(135deg, #2a2a3e, #1a1a2e);
      border: 1px solid #00d4ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 25px;
      font-size: 0.95rem;
      animation: slideIn 0.7s ease;
      color: #b0e0ff;
    }

    .section {
      background: linear-gradient(145deg, #2e2535, #3a2f3f);
      border: 1px solid #ff6b9d;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 25px;
      box-shadow: 0 4px 15px rgba(255, 107, 157, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeInUp 0.8s ease;
    }

    .section:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(255, 107, 157, 0.2);
    }

    h2 {
      margin-top: 0;
      font-size: 1.4rem;
      border-left: 4px solid #ff6b9d;
      padding-left: 10px;
      margin-bottom: 15px;
      color: #ffffff;
    }

    h3 {
      color: #ffffff;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    h4 {
      color: #ff6b9d;
      font-size: 1rem;
      margin-bottom: 8px;
    }

    label {
      display: block;
      color: #00ff88;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #1a1a1a;
      color: #ffffff;
      margin-bottom: 15px;
      font-size: 0.95rem;
      transition: border 0.3s ease, box-shadow 0.3s ease;
      box-sizing: border-box;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    select {
      height: var(--field-height);
      cursor: pointer;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    select:focus,
    textarea:focus {
      border-color: #ff6b9d;
      outline: none;
      box-shadow: 0 0 10px rgba(255, 107, 157, 0.3);
    }

    input[type="text"]::placeholder,
    textarea::placeholder {
      color: #888;
    }

    button {
      padding: 12px 18px;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.25s ease, box-shadow 0.3s ease;
      height: var(--field-height);
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
    }

    button:disabled {
      background: #555;
      color: #999;
      cursor: not-allowed;
      opacity: 0.6;
    }

    #issueCertBtn {
      background: linear-gradient(135deg, #00d4ff, #0096c7);
      color: #000;
      width: 100%;
      margin-top: 10px;
      height: 48px;
      font-size: 1.05rem;
    }

    #issueCertBtn:hover:not(:disabled) {
      background: linear-gradient(135deg, #00a8cc, #007a99);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
    }

    #revokeCertBtn {
      background: linear-gradient(135deg, #ff6b6b, #cc5555);
      color: #fff;
    }

    #revokeCertBtn:hover:not(:disabled) {
      background: linear-gradient(135deg, #ff5252, #b34343);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }

    #connectWallet {
      background: linear-gradient(135deg, #00ff88, #00d4ff);
      color: #000;
    }

    #connectWallet:hover {
      background: linear-gradient(135deg, #00cc6f, #00a8cc);
      box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
    }

    #refreshAdminStatus {
      background: linear-gradient(135deg, #17a2b8, #138496);
      color: #fff;
    }

    #refreshAdminStatus:hover {
      background: linear-gradient(135deg, #138496, #10707f);
      box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
    }

    .admin-btn {
      background: linear-gradient(135deg, #00d4ff, #0096c7);
      color: #000;
    }

    .admin-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #00a8cc, #007a99);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
    }

    .remove-btn {
      background: linear-gradient(135deg, #ff6b6b, #cc5555);
      color: #fff;
    }

    .remove-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #ff5252, #b34343);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }

    .check-btn {
      background: linear-gradient(135deg, #ffd700, #ffb300);
      color: #000;
    }

    .check-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #ffb300, #ff8c00);
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    }

    .status {
      margin: 15px 0;
      padding: 15px;
      border-radius: 8px;
      animation: fadeIn 0.5s ease;
    }

    .success {
      background: linear-gradient(135deg, #1a4d2e, #0f3a1f);
      color: #00ff88;
      border: 1px solid #00ff88;
    }

    .error {
      background: linear-gradient(135deg, #4d1a1a, #3a0f0f);
      color: #ff6b6b;
      border: 1px solid #ff6b6b;
    }

    .info {
      background: linear-gradient(135deg, #1a2d4d, #0f1f3a);
      color: #00d4ff;
      border: 1px solid #00d4ff;
    }

    .warning {
      background: linear-gradient(135deg, #4d3a1a, #3a2a0f);
      color: #ffd700;
      border: 1px solid #ffd700;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .spinner {
      border: 4px solid #333;
      border-top: 4px solid #ff6b9d;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 0;
    }

    .form-group-full {
      grid-column: 1 / -1;
    }

    .qr-display {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(145deg, #2a2a3e, #1e1e2e);
      border-radius: 8px;
      border: 1px solid #00ff88;
      text-align: center;
      display: none;
    }

    .qr-display h3 {
      color: #00ff88;
      margin-top: 0;
    }

    #qrCodeCanvas {
      background: white;
      padding: 10px;
      border-radius: 8px;
      margin: 15px auto;
      display: inline-block;
    }

    .qr-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }

    .qr-actions button {
      flex: 0 1 auto;
      padding: 10px 20px;
    }

    .revoke-section {
      margin-top: 25px;
      padding: 20px;
      background: linear-gradient(145deg, #2a2535, #352f3a);
      border-radius: 8px;
      border: 1px solid #ff6b6b;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .admin-card {
      background: linear-gradient(145deg, #2a2a3e, #1e1e2e);
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #444;
    }

    .check-admin-group {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .check-admin-group input {
      flex: 1;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .nav-links {
      margin-top: 20px;
      text-align: center;
      padding-top: 20px;
      border-top: 2px solid #333;
    }

    .nav-links p {
      color: #b0b0b0;
      margin-bottom: 10px;
    }

    .nav-links a {
      display: inline-block;
      padding: 10px 18px;
      margin: 5px;
      border-radius: 8px;
      background: linear-gradient(135deg, #00d4ff, #0096c7);
      color: #000;
      font-weight: 600;
      text-decoration: none;
      transition: transform 0.3s ease, background 0.25s ease, box-shadow 0.3s ease;
    }

    .nav-links a:hover {
      transform: translateY(-2px);
      background: linear-gradient(135deg, #00a8cc, #007a99);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
    }

    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .container {
        padding: 20px;
      }

      h1 {
        font-size: 1.8rem;
      }

      .form-grid,
      .admin-grid {
        grid-template-columns: 1fr;
      }

      .check-admin-group {
        flex-direction: column;
        align-items: stretch;
      }

      .qr-actions {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Manufacturer Portal</h1>

    <div class="network-info" id="networkInfo">
      <strong>Network Status:</strong> Connecting to blockchain...
    </div>

    <div class="section">
      <h2>Wallet Connection</h2>
      <p style="color: #b0b0b0; margin-bottom: 15px;"><strong>Connection required</strong> - Only authorized manufacturers can issue certificates</p>

      <div id="connectionStatus" class="status warning">
        <strong>Wallet Not Connected</strong><br>
        Connect your MetaMask wallet to manage certificates
      </div>

      <div id="adminStatusControls" style="display: none; margin-top: 10px;">
        <button id="refreshAdminStatus">
          Refresh My Authorization Status
        </button>
        <small style="display: block; margin-top: 5px; color: #888;">
          Click to refresh your permissions if they have been changed
        </small>
      </div>

      <button id="connectWallet">Connect MetaMask</button>
    </div>

    <div id="manufacturerControls" style="display: none;">
      <div class="section">
        <h2>Issue New Certificate</h2>
        <h3>Product Information</h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="productName">Product Name *</label>
            <input type="text" id="productName" placeholder="Enter product name">
          </div>
          
          <div class="form-group">
            <label for="mfgDate">Date of Manufacture *</label>
            <input type="text" id="mfgDate" placeholder="Select date">
          </div>
          
          <div class="form-group">
            <label for="location">Manufacturing Location *</label>
            <select id="location">
              <option value="">Select country...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="intendedRegion">Intended Region of Sale *</label>
            <select id="intendedRegion">
              <option value="">Select region...</option>
              <option value="Global">Global</option>
              <option value="North America">North America</option>
              <option value="South America">South America</option>
              <option value="Europe">Europe</option>
              <option value="Asia">Asia</option>
              <option value="Africa">Africa</option>
              <option value="Oceania">Oceania</option>
              <option value="Middle East">Middle East</option>
            </select>
          </div>
          
          <div class="form-group form-group-full">
            <label for="details">Product Details</label>
            <textarea id="details" placeholder="Enter product specifications, batch number, or other details..."></textarea>
          </div>
          
          <div class="form-group form-group-full">
            <label for="notes">Additional Notes</label>
            <textarea id="notes" placeholder="Enter any additional information..."></textarea>
          </div>
        </div>

        <button id="issueCertBtn" disabled>Issue Certificate & Generate QR Code</button>

        <div class="qr-display" id="qrDisplay">
          <h3>Certificate Created Successfully!</h3>
          <p><strong>Certificate ID:</strong> <span id="generatedCertId"></span></p>
          <canvas id="qrCodeCanvas"></canvas>
          <p style="color: #b0b0b0; margin: 10px 0;">Scan this QR code to verify the certificate</p>
          <div class="qr-actions">
            <button onclick="downloadQR()">Download QR Code</button>
            <button onclick="printQR()">Print QR Code</button>
          </div>
        </div>

        <div class="loading" id="issueLoading">
          <div class="spinner"></div>
          <p>Processing transaction...</p>
        </div>

        <div class="revoke-section">
          <h4>Revoke Certificate</h4>
          <p style="color: #b0b0b0; font-size: 0.9rem;">Enter certificate ID to revoke an existing certificate</p>
          <div style="display: flex; gap: 10px; align-items: flex-start;">
            <input type="text" id="revokeCertId" placeholder="Certificate ID to revoke" style="flex: 1; margin-bottom: 0;">
            <button id="revokeCertBtn" style="flex: 0 0 auto; width: auto;">Revoke Certificate</button>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Admin Management</h2>
        <p style="color: #b0b0b0; margin-bottom: 15px;"><strong>Owner Only</strong> - Manage manufacturer accounts</p>

        <div id="adminList" class="info status">
          Loading admin information...
        </div>

        <div class="admin-grid">
          <div class="admin-card">
            <h3>Add New Manufacturer</h3>
            <input type="text" id="newAdminAddress" placeholder="Enter wallet address (0x...)">
            <button id="addAdminBtn" class="admin-btn">Add Manufacturer</button>
          </div>

          <div class="admin-card">
            <h3>Remove Manufacturer</h3>
            <input type="text" id="removeAdminAddress" placeholder="Enter wallet address (0x...)">
            <button id="removeAdminBtn" class="remove-btn">Remove Manufacturer</button>
          </div>
        </div>

        <div class="admin-card" style="margin-top: 20px;">
          <h3>Check Authorization Status</h3>
          <div class="check-admin-group">
            <input type="text" id="checkAdminAddress" placeholder="Enter address to check (0x...)">
            <button id="checkAdminBtn" class="check-btn">Check Status</button>
          </div>
          <div id="adminCheckResult" style="margin-top: 10px;"></div>
        </div>

        <div class="loading" id="adminLoading">
          <div class="spinner"></div>
          <p>Processing admin operation...</p>
        </div>
      </div>
    </div>

    <div class="nav-links">
      <p><strong>Navigate to:</strong></p>
      <a href="index.html">Certificate Verification</a>
      <a href="distributor.html">Distributor/Consumer Portal</a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="app.js"></script>

  <script>
    // Initialize Flatpickr for date picker
    document.addEventListener('DOMContentLoaded', function () {
      try {
        if (typeof flatpickr !== 'undefined') {
          var el = document.getElementById('mfgDate');
          if (el) {
            flatpickr(el, {
              dateFormat: "Y-m-d",
              altInput: true,
              altFormat: "d M Y",
              maxDate: "today",
              allowInput: true,
              appendTo: document.body
            });
          }
        }
      } catch (e) {
        console.warn('Flatpickr init error:', e);
      }

      // Populate country dropdown
      const countries = [
        "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Argentina", "Armenia", "Australia", 
        "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", 
        "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", 
        "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cambodia", "Cameroon", "Canada", 
        "Cape Verde", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", 
        "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", 
        "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", 
        "Eritrea", "Estonia", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", 
        "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", 
        "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", 
        "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", 
        "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", 
        "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", 
        "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", 
        "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal", 
        "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", 
        "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", 
        "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", 
        "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", 
        "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", 
        "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", 
        "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", 
        "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", 
        "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", 
        "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", 
        "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Yemen", 
        "Zambia", "Zimbabwe"
      ];

      const locationSelect = document.getElementById('location');
      if (locationSelect) {
        countries.forEach(country => {
          const option = document.createElement('option');
          option.value = country;
          option.textContent = country;
          locationSelect.appendChild(option);
        });
      }
    });
  </script>
</body>
</html>